
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Developer preview documentation for HyperShift on Azure" name="description"/>
<meta content="HyperShift Community" name="author"/>
<link href="https://hypershift-community.github.io/azure-dev-preview/how-to/openstack/hostedcluster/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.8" name="generator"/>
<title>Create a HostedCluster on OpenStack - HyperShift Azure Developer Preview</title>
<link href="../../../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
 <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#accessing-the-hostedcluster">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="HyperShift Azure Developer Preview" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            HyperShift Azure Developer Preview
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Create a HostedCluster on OpenStack
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../azure/self-managed/01-understanding/">
        
  
    
  
  Understanding

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../azure/self-managed/02-planning/">
        
  
    
  
  Planning

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../azure/self-managed/03-azure-foundation/">
        
  
    
  
  Azure Setup

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../azure/self-managed/04-management-cluster/">
          
  
    
  
  Management &amp; Hosted Clusters

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../azure/self-managed/07-troubleshooting/">
          
  
    
  
  Reference

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="HyperShift Azure Developer Preview" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    HyperShift Azure Developer Preview
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/01-understanding/">
<span class="md-ellipsis">
    Understanding
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/02-planning/">
<span class="md-ellipsis">
    Planning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/03-azure-foundation/">
<span class="md-ellipsis">
    Azure Setup
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Management &amp; Hosted Clusters
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Management &amp; Hosted Clusters
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/04-management-cluster/">
<span class="md-ellipsis">
    Management Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/05-hosted-cluster/">
<span class="md-ellipsis">
    Create Hosted Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/06-day2-operations/">
<span class="md-ellipsis">
    Day 2 Operations
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/07-troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../azure/self-managed/08-reference/">
<span class="md-ellipsis">
    Reference
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#accessing-the-hostedcluster">
<span class="md-ellipsis">
      Accessing the HostedCluster
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ingress-and-dns-optional">
<span class="md-ellipsis">
      Ingress and DNS (optional)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#access-to-the-guest-cluster">
<span class="md-ellipsis">
      Access to the guest cluster
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scaling-an-existing-nodepool">
<span class="md-ellipsis">
      Scaling an existing NodePool
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#openstack-resources-tagging">
<span class="md-ellipsis">
      OpenStack resources tagging
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="create-a-hostedcluster-on-openstack">Create a HostedCluster on OpenStack</h1>
<p>Once all the <a href="../prerequisites/">prerequisites</a> are met, it is now possible to create a Hosted Cluster on OpenStack.</p>
<p>Here are the available options specific to the OpenStack platform:</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
<th>Required</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--openstack-ca-cert-file</code></td>
<td>Path to the OpenStack CA certificate file</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-cloud</code></td>
<td>Name of the cloud in <code>clouds.yaml</code></td>
<td>No</td>
<td><code>'openstack'</code></td>
</tr>
<tr>
<td><code>--openstack-credentials-file</code></td>
<td>Path to the OpenStack credentials file</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-external-network-id</code></td>
<td>ID of the OpenStack external network</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-ingress-floating-ip</code></td>
<td>A floating IP for OpenShift ingress</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-node-additional-port</code></td>
<td>Attach additional ports to nodes. Params: <code>network-id</code>, <code>vnic-type</code>, <code>disable-port-security</code>, <code>address-pairs</code>.</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-node-availability-zone</code></td>
<td>Availability zone for the nodepool</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-node-flavor</code></td>
<td>Flavor for the nodepool</td>
<td>Yes</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-node-image-name</code></td>
<td>Image name for the nodepool</td>
<td>No</td>
<td></td>
</tr>
<tr>
<td><code>--openstack-dns-nameservers</code></td>
<td>List of DNS server addresses that will be provided when creating the subnet</td>
<td>No</td>
<td></td>
</tr>
</tbody>
</table>
<p>Below is an example of how to create a cluster using environment variables and the <code>hcp</code> cli tool.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>--release-image</code> flag could be used to provision the HostedCluster with a specific OpenShift Release (the hypershift operator has a support matrix of releases supported by a given version of the operator).</p>
</div>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER_NAME</span><span class="o">=</span>example
<span class="nb">export</span><span class="w"> </span><span class="nv">BASE_DOMAIN</span><span class="o">=</span>hypershift.lab
<span class="nb">export</span><span class="w"> </span><span class="nv">PULL_SECRET</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/pull-secret"</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">WORKER_COUNT</span><span class="o">=</span><span class="s2">"2"</span>

<span class="c1"># OpenStack resources for the HostedCluster will be created</span>
<span class="c1"># in that project.</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">OS_CLOUD</span><span class="o">=</span><span class="s2">"openstack"</span>

<span class="c1"># Flavor for the nodepool</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">FLAVOR</span><span class="o">=</span><span class="s2">"m1.large"</span>

<span class="c1"># Pre-defined floating IP for Ingress</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">INGRESS_FLOATING_IP</span><span class="o">=</span><span class="s2">"&lt;ingress-floating-ip&gt;"</span>

<span class="c1"># Optional flags:</span>
<span class="c1"># External network to use for the Ingress endpoint.</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">EXTERNAL_NETWORK_ID</span><span class="o">=</span><span class="s2">"5387f86a-a10e-47fe-91c6-41ac131f9f30"</span>

<span class="c1"># CA certificate path to use for the OpenStack API if using self-signed certificates.</span>
<span class="c1"># In 4.18, this is not required as the CA cert found in clouds.yaml will be used.</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CA_CERT_PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/ca.crt"</span>

<span class="c1"># In 4.18, this is not required as the file will be discovered.</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">CLOUDS_YAML</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/clouds.yaml"</span>

<span class="c1"># SSH Key for the nodepool VMs</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SSH_KEY</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.ssh/id_rsa.pub"</span>

<span class="c1"># DNS nameserver for the subnet</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">DNS_NAMESERVERS</span><span class="o">=</span><span class="s2">"1.1.1.1"</span>

hcp<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>openstack<span class="w"> </span><span class="se">\</span>
--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span><span class="se">\</span>
--base-domain<span class="w"> </span><span class="nv">$BASE_DOMAIN</span><span class="w"> </span><span class="se">\</span>
--node-pool-replicas<span class="w"> </span><span class="nv">$WORKER_COUNT</span><span class="w"> </span><span class="se">\</span>
--pull-secret<span class="w"> </span><span class="nv">$PULL_SECRET</span><span class="w"> </span><span class="se">\</span>
--ssh-key<span class="w"> </span><span class="nv">$SSH_KEY</span><span class="w"> </span><span class="se">\</span>
--openstack-credentials-file<span class="w"> </span><span class="nv">$CLOUDS_YAML</span><span class="w"> </span><span class="se">\</span>
--openstack-ca-cert-file<span class="w"> </span><span class="nv">$CA_CERT_PATH</span><span class="w"> </span><span class="se">\</span>
--openstack-external-network-id<span class="w"> </span><span class="nv">$EXTERNAL_NETWORK_ID</span><span class="w"> </span><span class="se">\</span>
--openstack-node-flavor<span class="w"> </span><span class="nv">$FLAVOR</span><span class="w"> </span><span class="se">\</span>
--openstack-ingress-floating-ip<span class="w"> </span><span class="nv">$INGRESS_FLOATING_IP</span><span class="w"> </span><span class="se">\</span>
--openstack-dns-nameservers<span class="w"> </span><span class="nv">$DNS_NAMESERVERS</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A default NodePool will be created for the cluster with 2 VM worker replicas
per the <code>--node-pool-replicas</code> flag.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code>hcp</code> CLI, High Availability will be enabled by default.
Pods will be scheduled across different nodes to ensure that the control plane is highly available.
When the management cluster worker nodes are spread across different availability zones,
the hosted control plane will be spread across different availability zones as well in
<code>PreferredDuringSchedulingIgnoredDuringExecution</code> mode for <code>PodAntiAffinity</code>.
If your management cluster doesn't have enough workers (less than 3), which is not recommended nor supported,
you'll need to specify the <code>--control-plane-availability-policy</code> flag to <code>SingleReplica</code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When not providing the <code>--openstack-node-image-name</code> flag, the latest RHCOS image will be used.
ORC will handle the RHCOS image lifecycle by downloading the image from the OpenShift mirror and deleting it when the HostedCluster is deleted.
The OpenStack Glance Image will be named like this: <code>&lt;hosted-cluster-name&gt;-rhcos-&lt;rhcos-version&gt;</code>.</p>
</div>
<p>After a few moments we should see our hosted control plane pods up and running:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>-n<span class="w"> </span>clusters-<span class="nv">$CLUSTER_NAME</span><span class="w"> </span>get<span class="w"> </span>pods

NAME<span class="w">                                                  </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
capi-provider-5cc7b74f47-n5gkr<span class="w">                        </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>3m
catalog-operator-5f799567b7-fd6jw<span class="w">                     </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>69s
certified-operators-catalog-784b9899f9-mrp6p<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>66s
cluster-api-6bbc867966-l4dwl<span class="w">                          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>66s
.
.
.
redhat-operators-catalog-9d5fd4d44-z8qqk<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>66s
</code></pre></div>
<p>A guest cluster backed by OpenStack virtual machines typically takes around 10-15
minutes to fully provision.</p>
<h2 id="accessing-the-hostedcluster">Accessing the HostedCluster</h2>
<p>CLI access to the guest cluster is gained by retrieving the guest cluster's
kubeconfig. Below is an example of how to retrieve the guest cluster's
kubeconfig using the hcp cli.</p>
<div class="highlight"><pre><span></span><code>hcp<span class="w"> </span>create<span class="w"> </span>kubeconfig<span class="w"> </span>--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig
</code></pre></div>
<p>If we access the cluster, we will see we have two nodes.</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>--kubeconfig<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig<span class="w"> </span>get<span class="w"> </span>nodes

NAME<span class="w">                  </span>STATUS<span class="w">   </span>ROLES<span class="w">    </span>AGE<span class="w">   </span>VERSION
example-n6prw<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>32m<span class="w">   </span>v1.27.4+18eadca
example-nc6g4<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>32m<span class="w">   </span>v1.27.4+18eadca
</code></pre></div>
<p>We can also check the ClusterVersion:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>--kubeconfig<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig<span class="w"> </span>get<span class="w"> </span>clusterversion

NAME<span class="w">      </span>VERSION<span class="w">       </span>AVAILABLE<span class="w">   </span>PROGRESSING<span class="w">   </span>SINCE<span class="w">   </span>STATUS
version<span class="w">   </span><span class="m">4</span>.17.0<span class="w">        </span>True<span class="w">        </span>False<span class="w">         </span>5m39s<span class="w">   </span>Cluster<span class="w"> </span>version<span class="w"> </span>is<span class="w"> </span><span class="m">4</span>.17.0
</code></pre></div>
<h2 id="ingress-and-dns-optional">Ingress and DNS (optional)</h2>
<p>If you haven't created the HostedCluster with <code>--openstack-ingress-floating-ip</code>, you'll need to
update the DNS record with the floating IP address that was assigned to the <code>router-default</code> Service.</p>
<p>Once the workload cluster is deploying, the Ingress controller will be installed
and a router named <code>router-default</code> will be created in the <code>openshift-ingress</code> namespace.</p>
<p>You'll need to update your DNS with the external IP of that router so Ingress (and dependent operators like console) can work.</p>
<p>Once the HostedCluster is created, you need to wait for the <code>router-default</code> service to get an external IP:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>-w<span class="w"> </span>--kubeconfig<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig<span class="w"> </span>-n<span class="w"> </span>openshift-ingress<span class="w"> </span>get<span class="w"> </span>service/router-default<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.status.loadBalancer.ingress[0].ip}'</span>
</code></pre></div>
<p>When the external IP exists, you can now create a DNS A record for <code>*.apps.&lt;cluster-name&gt;.&lt;base-domain&gt;</code> that matches the returned IP address.
Once this is done, the Ingress operator will become healthy and the console will be accessible shortly after.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The DNS propagation time can vary so you might need to wait a few minutes before your HostedCluster becomes healthy.</p>
</div>
<h2 id="access-to-the-guest-cluster">Access to the guest cluster</h2>
<p>Once the HostedCluster is healthy, you should be able to access the OpenShift console by navigating
to <code>https://console-openshift-console.apps.&lt;cluster-name&gt;.&lt;base-domain&gt;</code> in your browser.</p>
<p>To get the <code>kubeadmin</code> password, you can run this command:
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>--namespace<span class="w"> </span>clusters<span class="w"> </span>Secret/<span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span>-kubeadmin-password<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.data.password}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>--decode
</code></pre></div></p>
<p>To know whether the HostedCluster is healthy, you can verify with this command:
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>--namespace<span class="w"> </span>clusters<span class="w"> </span>hostedclusters

NAME<span class="w">            </span>VERSION<span class="w">   </span>KUBECONFIG<span class="w">                       </span>PROGRESS<span class="w">   </span>AVAILABLE<span class="w">   </span>PROGRESSING<span class="w">   </span>MESSAGE
example<span class="w">         </span><span class="m">4</span>.17.0<span class="w">    </span>example-admin-kubeconfig<span class="w">         </span>Completed<span class="w">  </span>True<span class="w">        </span>False<span class="w">         </span>The<span class="w"> </span>hosted<span class="w"> </span>control<span class="w"> </span>plane<span class="w"> </span>is<span class="w"> </span>available
</code></pre></div></p>
<h2 id="scaling-an-existing-nodepool">Scaling an existing NodePool</h2>
<p>Manually scale a NodePool using the <code>oc scale</code> command:</p>
<div class="highlight"><pre><span></span><code><span class="nv">NODEPOOL_NAME</span><span class="o">=</span><span class="nv">$CLUSTER_NAME</span>
<span class="nv">NODEPOOL_REPLICAS</span><span class="o">=</span><span class="m">5</span>

oc<span class="w"> </span>scale<span class="w"> </span>nodepool/<span class="nv">$NODEPOOL_NAME</span><span class="w"> </span>--namespace<span class="w"> </span>clusters<span class="w"> </span>--replicas<span class="o">=</span><span class="nv">$NODEPOOL_REPLICAS</span>
</code></pre></div>
<p>After a while, in our hosted cluster this is what we will see:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>--kubeconfig<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig<span class="w"> </span>get<span class="w"> </span>nodes

NAME<span class="w">                  </span>STATUS<span class="w">   </span>ROLES<span class="w">    </span>AGE<span class="w">     </span>VERSION
example-9jvnf<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>97s<span class="w">     </span>v1.27.4+18eadca
example-n6prw<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>116m<span class="w">    </span>v1.27.4+18eadca
example-nc6g4<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>117m<span class="w">    </span>v1.27.4+18eadca
example-thp29<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>4m17s<span class="w">   </span>v1.27.4+18eadca
example-twxns<span class="w">         </span>Ready<span class="w">    </span>worker<span class="w">   </span>88s<span class="w">     </span>v1.27.4+18eadca
</code></pre></div>
<h2 id="openstack-resources-tagging">OpenStack resources tagging</h2>
<p>The OpenStack resources created by the CAPI provider are tagged with <code>openshiftClusterID=&lt;infraID&gt;</code>
but additional tags can be added to the resources via the <code>HostedCluster.Spec.Platform.OpenStack.Tags</code>
field when creating the HostedCluster with a given YAML file.</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="https://unpkg.com/mermaid@11.4.0/dist/mermaid.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>