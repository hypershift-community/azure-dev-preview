
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Developer preview documentation for HyperShift on Azure" name="description"/>
<meta content="HyperShift Community" name="author"/>
<link href="https://hypershift-community.github.io/azure-dev-preview/how-to/azure/self-managed/02-planning/" rel="canonical"/>
<link href="../01-understanding/" rel="prev"/>
<link href="../03-azure-foundation/" rel="next"/>
<link href="../../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.8" name="generator"/>
<title>Planning - HyperShift Azure Developer Preview</title>
<link href="../../../../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../../custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
 <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#target-audience">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="HyperShift Azure Developer Preview" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            HyperShift Azure Developer Preview
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Planning
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../01-understanding/">
        
  
    
  
  Understanding

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="./">
        
  
    
  
  Planning

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../03-azure-foundation/">
        
  
    
  
  Azure Setup

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../04-management-cluster/">
          
  
    
  
  Management &amp; Hosted Clusters

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../07-troubleshooting/">
          
  
    
  
  Reference

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="HyperShift Azure Developer Preview" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    HyperShift Azure Developer Preview
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01-understanding/">
<span class="md-ellipsis">
    Understanding
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Planning
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Planning
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#target-audience">
<span class="md-ellipsis">
      Target Audience
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-requirements">
<span class="md-ellipsis">
      Azure Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#management-cluster-requirements">
<span class="md-ellipsis">
      Management Cluster Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-configuration-files">
<span class="md-ellipsis">
      Required Configuration Files
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-planning-decisions">
<span class="md-ellipsis">
      Key Planning Decisions
    </span>
</a>
<nav aria-label="Key Planning Decisions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dns-management-strategy">
<span class="md-ellipsis">
      DNS Management Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-group-strategy">
<span class="md-ellipsis">
      Resource Group Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#naming-conventions">
<span class="md-ellipsis">
      Naming Conventions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#network-planning">
<span class="md-ellipsis">
      Network Planning
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-taskfile-vs-environment-variables">
<span class="md-ellipsis">
      Configuration: Taskfile vs Environment Variables
    </span>
</a>
<nav aria-label="Configuration: Taskfile vs Environment Variables" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-taskfile-variables-recommended">
<span class="md-ellipsis">
      Using Taskfile Variables (Recommended)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-envrc-optional-convenience">
<span class="md-ellipsis">
      Using .envrc (Optional Convenience)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deployment-flow">
<span class="md-ellipsis">
      Deployment Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03-azure-foundation/">
<span class="md-ellipsis">
    Azure Setup
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Management &amp; Hosted Clusters
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Management &amp; Hosted Clusters
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../04-management-cluster/">
<span class="md-ellipsis">
    Management Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05-hosted-cluster/">
<span class="md-ellipsis">
    Create Hosted Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06-day2-operations/">
<span class="md-ellipsis">
    Day 2 Operations
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../07-troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08-reference/">
<span class="md-ellipsis">
    Reference
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#target-audience">
<span class="md-ellipsis">
      Target Audience
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
<nav aria-label="Prerequisites" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#azure-requirements">
<span class="md-ellipsis">
      Azure Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#management-cluster-requirements">
<span class="md-ellipsis">
      Management Cluster Requirements
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#required-configuration-files">
<span class="md-ellipsis">
      Required Configuration Files
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-planning-decisions">
<span class="md-ellipsis">
      Key Planning Decisions
    </span>
</a>
<nav aria-label="Key Planning Decisions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dns-management-strategy">
<span class="md-ellipsis">
      DNS Management Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#resource-group-strategy">
<span class="md-ellipsis">
      Resource Group Strategy
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#naming-conventions">
<span class="md-ellipsis">
      Naming Conventions
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#network-planning">
<span class="md-ellipsis">
      Network Planning
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-taskfile-vs-environment-variables">
<span class="md-ellipsis">
      Configuration: Taskfile vs Environment Variables
    </span>
</a>
<nav aria-label="Configuration: Taskfile vs Environment Variables" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-taskfile-variables-recommended">
<span class="md-ellipsis">
      Using Taskfile Variables (Recommended)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#using-envrc-optional-convenience">
<span class="md-ellipsis">
      Using .envrc (Optional Convenience)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deployment-flow">
<span class="md-ellipsis">
      Deployment Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#next-steps">
<span class="md-ellipsis">
      Next Steps
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="planning-your-deployment">Planning Your Deployment</h1>
<p>This guide helps you prepare for a successful HyperShift on Azure deployment by outlining prerequisites, key decisions, and planning considerations.</p>
<h2 id="target-audience">Target Audience</h2>
<p>This guide is designed for <strong>veteran OpenShift administrators and SREs</strong> who are new to HyperShift. We assume you have:</p>
<ul>
<li>Strong knowledge of OpenShift/Kubernetes operations</li>
<li>Experience with Azure infrastructure and services</li>
<li>Understanding of networking, storage, and identity management concepts</li>
</ul>
<h2 id="prerequisites">Prerequisites</h2>
<h3 id="azure-requirements">Azure Requirements</h3>
<h4 id="azure-subscription-permissions">Azure Subscription &amp; Permissions</h4>
<ul>
<li>Active Azure subscription</li>
<li><strong>Subscription-level roles</strong>:<ul>
<li><code>Contributor</code> role</li>
<li><code>User Access Administrator</code> role</li>
</ul>
</li>
<li><strong>Microsoft Graph API permissions</strong>:<ul>
<li><code>Application.ReadWrite.OwnedBy</code> permission (for creating service principals)</li>
</ul>
</li>
</ul>
<h4 id="azure-resources">Azure Resources</h4>
<ul>
<li>A persistent resource group for shared resources (e.g., <code>hypershift-shared</code>)<ul>
<li>This resource group will contain workload identities, OIDC issuer, and optionally DNS zones</li>
<li>Should not be deleted when individual hosted clusters are removed</li>
</ul>
</li>
<li>(Optional) Parent DNS zone in Azure DNS for delegating cluster DNS records<ul>
<li>Required only if using External DNS for automatic DNS management</li>
<li>Must allow NS record delegation for subdomain zones</li>
</ul>
</li>
</ul>
<h4 id="tools-cli">Tools &amp; CLI</h4>
<ul>
<li>Azure CLI (<code>az</code>) installed and configured with the subscription</li>
<li><code>jq</code> command-line JSON processor</li>
<li>Cloud Credential Operator (CCO) tool (<code>ccoctl</code>) installed</li>
<li><a href="https://taskfile.dev">go-task/task</a> for running automation</li>
</ul>
<h3 id="management-cluster-requirements">Management Cluster Requirements</h3>
<h4 id="cluster-prerequisites">Cluster Prerequisites</h4>
<ul>
<li>An existing Kubernetes cluster (OpenShift or upstream Kubernetes) running in Azure</li>
<li>Cluster must have:<ul>
<li>Sufficient capacity for hosting control plane pods</li>
<li>Network connectivity to Azure APIs</li>
<li>Ability to create LoadBalancer services (if not using External DNS)</li>
</ul>
</li>
<li>Administrative access (<code>cluster-admin</code> permissions) to the management cluster</li>
</ul>
<h4 id="tools">Tools</h4>
<ul>
<li>OpenShift CLI (<code>oc</code>) or Kubernetes CLI (<code>kubectl</code>)</li>
<li>HyperShift CLI binary (<a href="https://github.com/hypershift-community/azure-dev-preview/releases">download</a>)</li>
<li>Valid OpenShift pull secret from <a href="https://console.redhat.com/openshift/downloads">cloud.redhat.com</a></li>
</ul>
<h3 id="required-configuration-files">Required Configuration Files</h3>
<p>You'll need these files during deployment:</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Purpose</th>
<th>Created By</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>azure-credentials.json</strong></td>
<td>Cluster operations (create/destroy)</td>
<td>You or Azure admin</td>
<td>Service principal credentials</td>
</tr>
<tr>
<td><strong>workload-identities.json</strong></td>
<td>Cluster component authentication</td>
<td><code>task azure:identities</code></td>
<td>Managed identity client IDs</td>
</tr>
<tr>
<td><strong>serviceaccount-signer.private/public</strong></td>
<td>Service account token signing</td>
<td><code>task prereq:keys</code></td>
<td>RSA key pair</td>
</tr>
<tr>
<td><strong>.azure-net-ids</strong></td>
<td>Network resource IDs</td>
<td><code>task azure:infra</code></td>
<td>Exported environment variables</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Azure Credentials File Format</p>
<p>The <code>azure-credentials.json</code> file should contain service principal credentials:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">"subscriptionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"tenantId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span><span class="p">,</span>
<span class="w">  </span><span class="nt">"clientSecret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"your-service-principal-secret"</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>How to create:</strong></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create service principal with required permissions</span>
<span class="nv">SP_DETAILS</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>ad<span class="w"> </span>sp<span class="w"> </span>create-for-rbac<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">"hypershift-cluster-ops"</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--role<span class="w"> </span>Contributor<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--scopes<span class="w"> </span><span class="s2">"/subscriptions/</span><span class="k">$(</span>az<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span><span class="s2">"</span><span class="k">)</span>

<span class="c1"># Extract values and create file</span>
cat<span class="w"> </span><span class="s">&lt;&lt;EOF &gt; azure-credentials.json</span>
<span class="s">{</span>
<span class="s">  "subscriptionId": "$(az account show --query id -o tsv)",</span>
<span class="s">  "tenantId": "$(az account show --query tenantId -o tsv)",</span>
<span class="s">  "clientID": "$(echo "$SP_DETAILS" | jq -r '.appId')",</span>
<span class="s">  "clientSecret": "$(echo "$SP_DETAILS" | jq -r '.password')"</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
</div>
<h2 id="key-planning-decisions">Key Planning Decisions</h2>
<h3 id="dns-management-strategy">DNS Management Strategy</h3>
<p>Choose how to handle DNS for your hosted clusters:</p>
<h4 id="option-1-with-external-dns-recommended-for-production">Option 1: With External DNS (Recommended for Production)</h4>
<p><strong>Best For</strong>: Production environments, multiple clusters, custom domains</p>
<p><strong>Characteristics</strong>:
- Automatic DNS record management via External DNS operator
- Custom domain names (e.g., <code>api.my-cluster.example.com</code>)
- Requires: DNS zones, service principal with DNS permissions, External DNS operator
- Higher initial setup complexity, but simpler ongoing operations</p>
<p><strong>Example DNS</strong>:
- API Server: <code>api.my-cluster.azure.example.com</code>
- Apps: <code>*.apps.my-cluster.azure.example.com</code></p>
<p><strong>Decision Criteria</strong>:
- Choose this if you need custom, branded domain names
- Choose this if you plan to manage multiple clusters
- Choose this if you want fully automated DNS provisioning</p>
<h4 id="option-2-without-external-dns-simpler-for-devtest">Option 2: Without External DNS (Simpler for Dev/Test)</h4>
<p><strong>Best For</strong>: Development, testing, proof-of-concept environments</p>
<p><strong>Characteristics</strong>:
- Manual DNS management or Azure-provided LoadBalancer DNS
- API server uses Azure LoadBalancer DNS (e.g., <code>abc123.eastus.cloudapp.azure.com</code>)
- No DNS zones or service principals needed
- Lower initial setup complexity, but requires manual DNS work for production use</p>
<p><strong>Example DNS</strong>:
- API Server: <code>my-cluster-api.eastus.cloudapp.azure.com</code>
- Apps: <code>my-cluster-apps.eastus.cloudapp.azure.com</code></p>
<p><strong>Decision Criteria</strong>:
- Choose this for quick testing or POC environments
- Choose this if you don't control your DNS infrastructure
- Choose this if you only need a single cluster temporarily</p>
<div class="admonition tip">
<p class="admonition-title">Recommendation</p>
<p><strong>Start with Option 2 (Without External DNS)</strong> for your first cluster to learn the basics. Once comfortable, you can deploy production clusters with Option 1 (External DNS).</p>
</div>
<h3 id="resource-group-strategy">Resource Group Strategy</h3>
<p>Plan your resource group structure to separate long-lived shared resources from cluster-specific resources:</p>
<h4 id="persistent-resource-group">Persistent Resource Group</h4>
<ul>
<li><strong>Name example</strong>: <code>hypershift-shared</code>, <code>openshift-common</code></li>
<li><strong>Lifecycle</strong>: Long-lived, not deleted when clusters are removed</li>
<li><strong>Contains</strong>:<ul>
<li>OIDC issuer (storage account)</li>
<li>Managed identities (per cluster, but persistent)</li>
<li>Federated identity credentials (per cluster, but persistent)</li>
<li>(Optional) DNS zones</li>
</ul>
</li>
</ul>
<h4 id="per-cluster-resource-groups">Per-Cluster Resource Groups</h4>
<ul>
<li><strong>Name pattern</strong>: <code>&lt;prefix&gt;-vnet-rg</code>, <code>&lt;prefix&gt;-nsg-rg</code>, <code>&lt;prefix&gt;-managed-rg</code></li>
<li><strong>Lifecycle</strong>: Created and deleted with each cluster</li>
<li><strong>Contains</strong>:<ul>
<li>Virtual Network (VNet)</li>
<li>Network Security Group (NSG)</li>
<li>Subnets</li>
<li>Virtual Machines (worker nodes)</li>
</ul>
</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Understanding Resource Persistence</p>
<p>Managed identities and federated credentials are <strong>per-cluster but persistent</strong>. They:</p>
<ul>
<li>Are created once per cluster</li>
<li>Remain after cluster deletion</li>
<li>Allow cluster recreation without identity recreation</li>
<li>Preserve Azure IAM role assignments</li>
<li>Support disaster recovery scenarios</li>
</ul>
<p>Network infrastructure is <strong>temporary</strong> and deleted with the cluster.</p>
</div>
<h3 id="naming-conventions">Naming Conventions</h3>
<p>Establish consistent naming patterns:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Example naming pattern</span>
<span class="nv">PREFIX</span><span class="o">=</span><span class="s2">"myorg-dev"</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-hc"</span><span class="w">           </span><span class="c1"># e.g., myorg-dev-hc</span>
<span class="nv">PERSISTENT_RG</span><span class="o">=</span><span class="s2">"hypershift-shared"</span><span class="w">     </span><span class="c1"># Shared across all clusters</span>
<span class="nv">VNET_RG_NAME</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-vnet-rg"</span><span class="w">      </span><span class="c1"># e.g., myorg-dev-vnet-rg</span>
</code></pre></div>
<h3 id="network-planning">Network Planning</h3>
<h4 id="vnet-and-subnet-design">VNet and Subnet Design</h4>
<ul>
<li>Default: <code>/16</code> VNet with <code>/24</code> subnet</li>
<li>Plan for sufficient IP addresses for worker nodes</li>
<li>Consider network security group (NSG) rules for your environment</li>
<li>Ensure network connectivity to Azure APIs and management cluster</li>
</ul>
<h4 id="network-security">Network Security</h4>
<ul>
<li>NSG rules are created automatically</li>
<li>Review and customize based on your security requirements</li>
<li>Consider private endpoint requirements for production</li>
</ul>
<h2 id="configuration-taskfile-vs-environment-variables">Configuration: Taskfile vs Environment Variables</h2>
<p>This repository uses <strong>Taskfile automation</strong> as the primary approach:</p>
<h3 id="using-taskfile-variables-recommended">Using Taskfile Variables (Recommended)</h3>
<p>All configuration is defined in <code>hack/dev-preview/Taskfile.yml</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">vars</span><span class="p">:</span>
<span class="w">  </span><span class="nt">PREFIX</span><span class="p">:</span><span class="w"> </span><span class="s">'myorg-dev'</span>
<span class="w">  </span><span class="nt">SUBSCRIPTION_ID</span><span class="p">:</span><span class="w"> </span><span class="s">'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'</span>
<span class="w">  </span><span class="nt">TENANT_ID</span><span class="p">:</span><span class="w"> </span><span class="s">'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'</span>
<span class="w">  </span><span class="nt">LOCATION</span><span class="p">:</span><span class="w"> </span><span class="s">'eastus'</span>
<span class="w">  </span><span class="nt">PERSISTENT_RG_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">'hypershift-shared'</span>
<span class="w">  </span><span class="nt">OIDC_STORAGE_ACCOUNT_NAME</span><span class="p">:</span><span class="w"> </span><span class="s">'myorgoidc1234567890'</span>
<span class="w">  </span><span class="c1"># ... etc</span>
</code></pre></div>
<p>This approach provides:
- <strong>Self-documenting configuration</strong>: All variables visible in one file
- <strong>Validation</strong>: Taskfile validates required variables
- <strong>Consistency</strong>: Same variables used across all tasks</p>
<h3 id="using-envrc-optional-convenience">Using .envrc (Optional Convenience)</h3>
<p>An <code>envrc.example</code> file is provided for convenience with tools like <a href="https://direnv.net/">direnv</a>:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">PREFIX</span><span class="o">=</span><span class="s2">"myorg-dev"</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">SUBSCRIPTION_ID</span><span class="o">=</span><span class="s2">"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"</span>
<span class="c1"># ... etc</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Primary vs Secondary</p>
<ul>
<li><strong>Primary</strong>: Edit variables in <code>Taskfile.yml</code></li>
<li><strong>Secondary</strong>: Use <code>.envrc</code> for convenience if you prefer environment variables</li>
<li>The Taskfile reads from environment variables when available</li>
</ul>
</div>
<h2 id="deployment-flow">Deployment Flow</h2>
<p>Understanding the deployment sequence:</p>
<div class="mermaid">graph TD
    A[Prerequisites] --&gt;|task prereq:validate| B[Generate Keys]
    B --&gt;|task prereq:keys| C[OIDC Setup]
    C --&gt;|task azure:oidc| D[Create Identities]
    D --&gt;|task azure:identities| E[Federated Credentials]
    E --&gt;|task azure:federated-creds| F[Network Infrastructure]
    F --&gt;|task azure:infra| G[Create Cluster]
    G --&gt;|task cluster:create| H[Hosted Cluster Running]
</div>
<ol>
<li><strong>Validate prerequisites</strong> - Ensure all tools and credentials are available</li>
<li><strong>Generate signing keys</strong> - Create service account token signing key pair</li>
<li><strong>OIDC setup</strong> - Create shared OIDC issuer (one-time)</li>
<li><strong>Create identities</strong> - Create managed identities (per cluster, persistent)</li>
<li><strong>Federated credentials</strong> - Link identities to service accounts (per cluster, persistent)</li>
<li><strong>Network infrastructure</strong> - Create VNet, NSG, subnets (per cluster, temporary)</li>
<li><strong>Create cluster</strong> - Deploy the hosted cluster</li>
</ol>
<h2 id="next-steps">Next Steps</h2>
<p>Now that you've planned your deployment:</p>
<ul>
<li><a href="../03-azure-foundation/">Azure Foundation Setup</a> - Set up Azure infrastructure using Taskfile automation</li>
<li><a href="../04-management-cluster/">Management Cluster Setup</a> - Prepare your management cluster</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="https://unpkg.com/mermaid@11.2.0/dist/mermaid.min.js"></script>
<script>mermaid.initialize({});</script><script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>