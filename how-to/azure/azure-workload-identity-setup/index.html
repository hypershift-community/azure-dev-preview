
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Developer preview documentation for HyperShift on Azure">
      
      
        <meta name="author" content="HyperShift Community">
      
      
        <link rel="canonical" href="https://hypershift-community.github.io/azure-dev-preview/how-to/azure/azure-workload-identity-setup/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Azure Workload Identity Setup for Self-Managed Clusters - HyperShift Azure Developer Preview</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prerequisites" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="HyperShift Azure Developer Preview" class="md-header__button md-logo" aria-label="HyperShift Azure Developer Preview" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HyperShift Azure Developer Preview
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Azure Workload Identity Setup for Self-Managed Clusters
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/01-understanding/" class="md-tabs__link">
        
  
    
  
  Understanding

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/02-planning/" class="md-tabs__link">
        
  
    
  
  Planning

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/03-azure-foundation/" class="md-tabs__link">
        
  
    
  
  Azure Setup

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../self-managed/04-management-cluster/" class="md-tabs__link">
          
  
    
  
  Management & Hosted Clusters

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../self-managed/07-troubleshooting/" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="HyperShift Azure Developer Preview" class="md-nav__button md-logo" aria-label="HyperShift Azure Developer Preview" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HyperShift Azure Developer Preview
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/01-understanding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/02-planning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/03-azure-foundation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Management & Hosted Clusters
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Management & Hosted Clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/04-management-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Management Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/05-hosted-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Hosted Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/06-day2-operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 2 Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/07-troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/08-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-azure-workload-identities" class="md-nav__link">
    <span class="md-ellipsis">
      Create Azure Workload Identities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-workload-identities-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create Workload Identities Configuration File
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-oidc-issuer" class="md-nav__link">
    <span class="md-ellipsis">
      Configure OIDC Issuer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-federated-identity-credentials" class="md-nav__link">
    <span class="md-ellipsis">
      Set Up Federated Identity Credentials
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Next Steps
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="azure-workload-identity-setup-for-self-managed-clusters">Azure Workload Identity Setup for Self-Managed Clusters</h1>
<div class="admonition note">
<p class="admonition-title">Developer Preview in OCP 4.21</p>
<p>Self-managed Azure HostedClusters are available as a Developer Preview feature in OpenShift Container Platform 4.21.</p>
</div>
<p>This document describes how to set up Azure Workload Identities and OIDC issuer for self-managed Azure HostedClusters.</p>
<div class="admonition warning">
<p class="admonition-title">Persistent Resource Groups</p>
<p>When setting up workload identities and OIDC issuer for the first time, create them in a <strong>persistent resource group</strong> that will not be deleted when individual clusters are destroyed. This allows you to reuse the same workload identities and OIDC issuer across multiple HostedClusters, reducing setup time and avoiding unnecessary resource recreation.</p>
<ul>
<li>Use a persistent resource group like <code>os4-common</code>.</li>
<li>This resource group should be separate from the cluster-specific resource groups that get created and deleted with each HostedCluster.</li>
<li>The OIDC issuer storage account should also be created in this persistent resource group.</li>
</ul>
</div>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Azure CLI (<code>az</code>) installed and configured</li>
<li><code>jq</code> command-line JSON processor</li>
<li>Cloud Credential Operator (CCO) tool installed</li>
<li>Appropriate Azure permissions</li>
</ul>
<h2 id="create-azure-workload-identities">Create Azure Workload Identities</h2>
<p>Create managed identities for each OpenShift component that needs Azure access:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set environment variables</span>
<span class="nv">PERSISTENT_RG_NAME</span><span class="o">=</span><span class="s2">&quot;os4-common&quot;</span><span class="w">  </span><span class="c1"># Use persistent resource group</span>
<span class="nv">LOCATION</span><span class="o">=</span><span class="s2">&quot;eastus&quot;</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">&quot;my-self-managed-cluster&quot;</span>
<span class="nv">SUBSCRIPTION_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>account<span class="w"> </span>show<span class="w"> </span>--query<span class="w"> </span>id<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>

<span class="c1"># Create persistent resource group (if it doesn&#39;t exist)</span>
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="nv">$PERSISTENT_RG_NAME</span><span class="w"> </span>--location<span class="w"> </span><span class="nv">$LOCATION</span>

<span class="c1"># Create managed identities for each component</span>
<span class="nb">declare</span><span class="w"> </span>-A<span class="w"> </span><span class="nv">COMPONENTS</span><span class="o">=(</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;image-registry&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-image-registry-operator&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;ingress&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-ingress-operator&quot;</span><span class="w">  </span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;file-csi&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-storage-operator-file&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;disk-csi&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-storage-operator-disk&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;nodepool-mgmt&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-api-provider-azure&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;cloud-provider&quot;</span><span class="o">]=</span><span class="s2">&quot;azure-cloud-provider&quot;</span>
<span class="w">    </span><span class="o">[</span><span class="s2">&quot;network&quot;</span><span class="o">]=</span><span class="s2">&quot;cluster-network-operator&quot;</span>
<span class="o">)</span>

<span class="c1"># Create managed identities and capture client IDs</span>
<span class="nb">declare</span><span class="w"> </span>-A<span class="w"> </span>CLIENT_IDS
<span class="k">for</span><span class="w"> </span>component<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="p">!COMPONENTS[@]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Creating managed identity for </span><span class="nv">$component</span><span class="s2">...&quot;</span>
<span class="w">    </span><span class="nv">CLIENT_ID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>identity<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">component</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--resource-group<span class="w"> </span><span class="nv">$PERSISTENT_RG_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--query<span class="w"> </span>clientId<span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
<span class="w">    </span>CLIENT_IDS<span class="o">[</span><span class="nv">$component</span><span class="o">]=</span><span class="nv">$CLIENT_ID</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Created identity </span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-</span><span class="si">${</span><span class="nv">component</span><span class="si">}</span><span class="s2"> with client ID: </span><span class="nv">$CLIENT_ID</span><span class="s2">&quot;</span>
<span class="k">done</span>
</code></pre></div>
<h2 id="create-workload-identities-configuration-file">Create Workload Identities Configuration File</h2>
<p>Create a JSON file with all the workload identity client IDs:</p>
<div class="highlight"><pre><span></span><code>cat<span class="w"> </span><span class="s">&lt;&lt;EOF &gt; workload-identities.json</span>
<span class="s">{</span>
<span class="s">  &quot;imageRegistry&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[image-registry]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;ingress&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[ingress]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;file&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[file-csi]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;disk&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[disk-csi]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;nodePoolManagement&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[nodepool-mgmt]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;cloudProvider&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[cloud-provider]}&quot;</span>
<span class="s">  },</span>
<span class="s">  &quot;network&quot;: {</span>
<span class="s">    &quot;clientID&quot;: &quot;${CLIENT_IDS[network]}&quot;</span>
<span class="s">  }</span>
<span class="s">}</span>
<span class="s">EOF</span>
</code></pre></div>
<h2 id="configure-oidc-issuer">Configure OIDC Issuer</h2>
<p>Use the Cloud Credential Operator (CCO) tool to create the OIDC issuer:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Set OIDC issuer variables (reusing variables from previous steps)</span>
<span class="nv">OIDC_STORAGE_ACCOUNT_NAME</span><span class="o">=</span><span class="s2">&quot;yourstorageaccount&quot;</span>
<span class="nv">TENANT_ID</span><span class="o">=</span><span class="s2">&quot;your-tenant-id&quot;</span>
<span class="c1"># SUBSCRIPTION_ID and PERSISTENT_RG_NAME already set from previous section</span>
<span class="c1"># Create an RSA key pair and save the private and public key</span>
ccoctl<span class="w"> </span>azure<span class="w"> </span>create-key-pair<span class="w">  </span>

<span class="nv">SA_TOKEN_ISSUER_PRIVATE_KEY_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/serviceaccount-signer.private&quot;</span>
<span class="nv">SA_TOKEN_ISSUER_PUBLIC_KEY_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/serviceaccount-signer.public&quot;</span>

<span class="c1"># Create OIDC issuer using CCO tool in os4-common resource group</span>
ccoctl<span class="w"> </span>azure<span class="w"> </span>create-oidc-issuer<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--oidc-resource-group-name<span class="w"> </span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--tenant-id<span class="w"> </span><span class="si">${</span><span class="nv">TENANT_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--region<span class="w"> </span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="si">${</span><span class="nv">OIDC_STORAGE_ACCOUNT_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subscription-id<span class="w"> </span><span class="si">${</span><span class="nv">SUBSCRIPTION_ID</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--public-key-file<span class="w"> </span><span class="si">${</span><span class="nv">SA_TOKEN_ISSUER_PUBLIC_KEY_PATH</span><span class="si">}</span>

<span class="c1"># Set OIDC issuer URL</span>
<span class="nv">OIDC_ISSUER_URL</span><span class="o">=</span><span class="s2">&quot;https://</span><span class="si">${</span><span class="nv">OIDC_STORAGE_ACCOUNT_NAME</span><span class="si">}</span><span class="s2">.blob.core.windows.net/</span><span class="si">${</span><span class="nv">OIDC_STORAGE_ACCOUNT_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
<h2 id="set-up-federated-identity-credentials">Set Up Federated Identity Credentials</h2>
<p>Configure federated identity credentials for each workload identity. These establish trust between Azure Entra ID and the specific service accounts in your HostedCluster:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Define workload identity names (matching those created earlier)</span>
<span class="c1"># These should match the managed identities created in the previous section</span>
<span class="nv">AZURE_DISK_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-disk-csi&quot;</span>
<span class="nv">AZURE_FILE_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-file-csi&quot;</span>
<span class="nv">IMAGE_REGISTRY_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-image-registry&quot;</span>
<span class="nv">INGRESS_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-ingress&quot;</span>
<span class="nv">CLOUD_PROVIDER_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-cloud-provider&quot;</span>
<span class="nv">NODE_POOL_MANAGEMENT_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-nodepool-mgmt&quot;</span>
<span class="nv">NETWORK_MI_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span><span class="s2">-network&quot;</span>

<span class="c1"># Azure Disk CSI Driver federated credentials</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-node&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-disk-csi-driver-node-sa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-operator&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-disk-csi-driver-operator<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-controller&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-disk-csi-driver-controller-sa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Azure File CSI Driver federated credentials</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-node&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-file-csi-driver-node-sa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-operator&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-file-csi-driver-operator<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-controller&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_FILE_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cluster-csi-drivers:azure-file-csi-driver-controller-sa<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Image Registry federated credentials</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IMAGE_REGISTRY_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-registry&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IMAGE_REGISTRY_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-image-registry:registry<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IMAGE_REGISTRY_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id-operator&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">IMAGE_REGISTRY_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-image-registry:cluster-image-registry-operator<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Ingress Operator federated credential</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">INGRESS_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">INGRESS_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-ingress-operator:ingress-operator<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Cloud Provider federated credential</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLOUD_PROVIDER_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CLOUD_PROVIDER_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:kube-system:azure-cloud-provider<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Node Pool Management federated credential</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NODE_POOL_MANAGEMENT_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NODE_POOL_MANAGEMENT_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:kube-system:capi-provider<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift

<span class="c1"># Network Operator federated credential</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NETWORK_MI_NAME</span><span class="si">}</span><span class="s2">-fed-id&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NETWORK_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--issuer<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subject<span class="w"> </span>system:serviceaccount:openshift-cloud-network-config-controller:cloud-network-config-controller<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--audience<span class="w"> </span>openshift
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Service Account Mapping</p>
<p>Each federated identity credential maps a specific Azure managed identity to an OpenShift service account. The service accounts listed above are the default service accounts used by various OpenShift components for Azure integration.</p>
</div>
<h2 id="verification">Verification</h2>
<p>Verify the setup:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List created managed identities</span>
az<span class="w"> </span>identity<span class="w"> </span>list<span class="w"> </span>--resource-group<span class="w"> </span><span class="nv">$PERSISTENT_RG_NAME</span><span class="w"> </span>--output<span class="w"> </span>table

<span class="c1"># Verify federated credentials for one identity</span>
az<span class="w"> </span>identity<span class="w"> </span>federated-credential<span class="w"> </span>list<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--identity-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">AZURE_DISK_MI_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="nv">$PERSISTENT_RG_NAME</span>

<span class="c1"># Test OIDC issuer accessibility</span>
curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">/.well-known/openid-configuration&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</code></pre></div>
<h2 id="next-steps">Next Steps</h2>
<p>After setting up workload identities, you can proceed to:</p>
<ul>
<li><a href="../setup-management-cluster/">Setup Azure Management Cluster for HyperShift</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>