
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Developer preview documentation for HyperShift on Azure">
      
      
        <meta name="author" content="HyperShift Community">
      
      
        <link rel="canonical" href="https://hypershift-community.github.io/azure-dev-preview/how-to/azure/create-self-managed-azure-cluster/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Create a Self-Managed Azure HostedCluster - HyperShift Azure Developer Preview</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#overview" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="HyperShift Azure Developer Preview" class="md-header__button md-logo" aria-label="HyperShift Azure Developer Preview" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HyperShift Azure Developer Preview
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Create a Self-Managed Azure HostedCluster
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/01-understanding/" class="md-tabs__link">
        
  
    
  
  Understanding

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/02-planning/" class="md-tabs__link">
        
  
    
  
  Planning

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../self-managed/03-azure-foundation/" class="md-tabs__link">
        
  
    
  
  Azure Setup

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../self-managed/04-management-cluster/" class="md-tabs__link">
          
  
    
  
  Management & Hosted Clusters

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../self-managed/07-troubleshooting/" class="md-tabs__link">
          
  
    
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="HyperShift Azure Developer Preview" class="md-nav__button md-logo" aria-label="HyperShift Azure Developer Preview" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    HyperShift Azure Developer Preview
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/01-understanding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/02-planning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Planning
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/03-azure-foundation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Management & Hosted Clusters
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Management & Hosted Clusters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/04-management-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Management Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/05-hosted-cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create Hosted Cluster
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/06-day2-operations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Day 2 Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/07-troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../self-managed/08-reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      Prerequisites
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Prerequisites">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#permission-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Permission Requirements
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-the-self-managed-azure-hostedcluster" class="md-nav__link">
    <span class="md-ellipsis">
      Creating the Self-Managed Azure HostedCluster
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Creating the Self-Managed Azure HostedCluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#infrastructure-setup" class="md-nav__link">
    <span class="md-ellipsis">
      Infrastructure Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-hostedcluster" class="md-nav__link">
    <span class="md-ellipsis">
      Create the HostedCluster
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuring-azure-marketplace-images" class="md-nav__link">
    <span class="md-ellipsis">
      Configuring Azure Marketplace Images
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#verification" class="md-nav__link">
    <span class="md-ellipsis">
      Verification
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cleanup" class="md-nav__link">
    <span class="md-ellipsis">
      Cleanup
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      Related Documentation
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="create-a-self-managed-azure-hostedcluster">Create a Self-Managed Azure HostedCluster</h1>
<div class="admonition note">
<p class="admonition-title">Developer Preview in OCP 4.21</p>
<p>Self-managed Azure HostedClusters are available as a Developer Preview feature in OpenShift Container Platform 4.21.</p>
</div>
<p>This document describes how to create a self-managed Azure HostedCluster using workload identities for authentication.</p>
<h2 id="overview">Overview</h2>
<p>Self-managed Azure HostedClusters use <a href="https://azure.github.io/azure-workload-identity/docs/">Azure Workload Identity</a> for authentication.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before creating a self-managed Azure HostedCluster, ensure you have:</p>
<ul>
<li>Azure CLI (<code>az</code>) installed and configured</li>
<li>HyperShift CLI binary</li>
<li>OpenShift CLI (<code>oc</code>) or Kubernetes CLI (<code>kubectl</code>)</li>
<li><code>jq</code> command-line JSON processor</li>
<li>An Azure OpenShift management cluster with HyperShift operator installed</li>
<li>Azure workload identities and OIDC issuer configured</li>
<li>Appropriate Azure permissions (see <a href="#permission-requirements">Permission Requirements</a>)</li>
<li><strong>Optional</strong>: External DNS configured (only if you want automatic DNS management)</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Setup Requirements</p>
<p>This guide assumes you have already completed the workload identity configuration and management cluster setup. Follow these guides in order:</p>
<ol>
<li><a href="../azure-workload-identity-setup/">Azure Workload Identity Setup</a> - Workload identities and OIDC issuer configuration</li>
<li><a href="../setup-management-cluster/">Setup Azure Management Cluster for HyperShift</a> - HyperShift operator installation (with or without External DNS)</li>
</ol>
</div>
<h3 id="permission-requirements">Permission Requirements</h3>
<p>Your Azure service principal must have the following permissions:</p>
<ul>
<li><strong>Subscription Level</strong>:<ul>
<li><code>Contributor</code> role</li>
<li><code>User Access Administrator</code> role</li>
</ul>
</li>
<li><strong>Microsoft Graph API</strong>:<ul>
<li><code>Application.ReadWrite.OwnedBy</code> permission (requires DPTP request in most cases)</li>
</ul>
</li>
</ul>
<h2 id="creating-the-self-managed-azure-hostedcluster">Creating the Self-Managed Azure HostedCluster</h2>
<h3 id="infrastructure-setup">Infrastructure Setup</h3>
<p>Before creating the HostedCluster, set up the necessary Azure infrastructure:</p>
<div class="admonition note">
<p class="admonition-title">About PERSISTENT_RG_NAME</p>
<p>In Red Hat environments, a periodic Azure resource "reaper" deletes resources that are not properly tagged or not located in an approved resource group. We frequently use the <code>os4-common</code> resource group for shared, long-lived assets (for example, public DNS zones) to avoid accidental cleanup. If you are not in Red Hat infrastructure, set <code>PERSISTENT_RG_NAME</code> to any long-lived resource group in your subscription that will not be automatically reaped, or ensure your organization's required tags/policies are applied. The name does not have to be <code>os4-common</code>â€”use whatever persistent resource group fits your environment.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="c1"># Set cluster configuration variables</span>
<span class="nv">PREFIX</span><span class="o">=</span><span class="s2">&quot;your-prefix-sm&quot;</span>
<span class="nv">RELEASE_IMAGE</span><span class="o">=</span><span class="s2">&quot;quay.io/openshift-release-dev/ocp-release:XYZ&quot;</span>
<span class="nv">TAG</span><span class="o">=</span><span class="s2">&quot;latest&quot;</span>

<span class="nv">LOCATION</span><span class="o">=</span><span class="s2">&quot;eastus&quot;</span>
<span class="nv">MANAGED_RG_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-managed-rg&quot;</span>
<span class="nv">VNET_RG_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-customer-vnet-rg&quot;</span>
<span class="nv">NSG_RG_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-customer-nsg-rg&quot;</span>
<span class="nv">VNET_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-customer-vnet&quot;</span>
<span class="nv">VNET_SUBNET1</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-customer-subnet-1&quot;</span>
<span class="nv">NSG</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-customer-nsg&quot;</span>
<span class="nv">DNS_ZONE_NAME</span><span class="o">=</span><span class="s2">&quot;your-subdomain.your-parent.dns.zone.com&quot;</span>
<span class="nv">CLUSTER_NAMESPACE</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span>
<span class="nv">CLUSTER_NAME</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">PREFIX</span><span class="si">}</span><span class="s2">-hc&quot;</span>
<span class="nv">AZURE_CREDS</span><span class="o">=</span><span class="s2">&quot;/path/to/azure/credentials&quot;</span>
<span class="nv">PULL_SECRET</span><span class="o">=</span><span class="s2">&quot;/path/to/pull-secret.json&quot;</span>
<span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/hypershift/bin&quot;</span>
<span class="nv">OIDC_ISSUER_URL</span><span class="o">=</span><span class="s2">&quot;https://yourstorageaccount.blob.core.windows.net/yourstorageaccount&quot;</span>
<span class="nv">SA_TOKEN_ISSUER_PRIVATE_KEY_PATH</span><span class="o">=</span><span class="s2">&quot;/path/to/serviceaccount-signer.private&quot;</span>
<span class="nv">PERSISTENT_RG_NAME</span><span class="o">=</span><span class="s2">&quot;os4-common&quot;</span>
<span class="nv">PARENT_DNS_ZONE</span><span class="o">=</span><span class="s2">&quot;your-parent.dns.zone.com&quot;</span>

<span class="c1"># Clean up any previous instances (optional)</span>
az<span class="w"> </span>group<span class="w"> </span>delete<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--yes<span class="w"> </span>--no-wait<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>
az<span class="w"> </span>group<span class="w"> </span>delete<span class="w"> </span>-n<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NSG_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--yes<span class="w"> </span>--no-wait<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">true</span>

<span class="c1"># Create managed resource group</span>
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANAGED_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--location<span class="w"> </span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span>

<span class="c1"># Create VNET &amp; NSG resource groups</span>
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--location<span class="w"> </span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span>
az<span class="w"> </span>group<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NSG_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>--location<span class="w"> </span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span>

<span class="c1"># Create network security group</span>
az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NSG_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">NSG</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Get NSG ID</span>
<span class="nv">GetNsgID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>network<span class="w"> </span>nsg<span class="w"> </span>list<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[?name==&#39;</span><span class="si">${</span><span class="nv">NSG</span><span class="si">}</span><span class="s2">&#39;].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>

<span class="c1"># Create VNet with subnet</span>
az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--address-prefix<span class="w"> </span><span class="m">10</span>.0.0.0/16<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subnet-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_SUBNET1</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subnet-prefixes<span class="w"> </span><span class="m">10</span>.0.0.0/24<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--nsg<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GetNsgID</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Get VNet and Subnet IDs</span>
<span class="nv">GetVnetID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>list<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[?name==&#39;</span><span class="si">${</span><span class="nv">VNET_NAME</span><span class="si">}</span><span class="s2">&#39;].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
<span class="nv">GetSubnetID</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>network<span class="w"> </span>vnet<span class="w"> </span>subnet<span class="w"> </span>show<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--vnet-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_SUBNET1</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">VNET_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--query<span class="w"> </span>id<span class="w"> </span>--output<span class="w"> </span>tsv<span class="k">)</span>
</code></pre></div>
<h3 id="create-the-hostedcluster">Create the HostedCluster</h3>
<div class="admonition note">
<p class="admonition-title">Federated Identity Prerequisites</p>
<p>Before creating the cluster, ensure that all federated identity credentials have been set up for your workload identities as described in the <a href="../azure-workload-identity-setup/">Azure Workload Identity Setup</a> guide. The cluster creation will fail if these are not properly configured.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Azure Marketplace Images</p>
<p>For OpenShift 4.20 and later, HyperShift automatically selects the appropriate Azure Marketplace image from the release payload. You no longer need to specify <code>--marketplace-*</code> flags unless you want to use a specific custom image. See <a href="#configuring-azure-marketplace-images">Configuring Azure Marketplace Images</a> for more details.</p>
</div>
<p>Create the HostedCluster:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Create the HostedCluster</span>
<span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--namespace<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAMESPACE</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--azure-creds<span class="w"> </span><span class="nv">$AZURE_CREDS</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--location<span class="w"> </span><span class="si">${</span><span class="nv">LOCATION</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--node-pool-replicas<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--base-domain<span class="w"> </span><span class="nv">$PARENT_DNS_ZONE</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--pull-secret<span class="w"> </span><span class="nv">$PULL_SECRET</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--generate-ssh<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--release-image<span class="w"> </span><span class="si">${</span><span class="nv">RELEASE_IMAGE</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--external-dns-domain<span class="w"> </span><span class="si">${</span><span class="nv">DNS_ZONE_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group-name<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">MANAGED_RG_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--vnet-id<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GetVnetID</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--subnet-id<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GetSubnetID</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--network-security-group-id<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">GetNsgID</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--sa-token-issuer-private-key-path<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">SA_TOKEN_ISSUER_PRIVATE_KEY_PATH</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--oidc-issuer-url<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">OIDC_ISSUER_URL</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--control-plane-operator-image<span class="o">=</span><span class="s2">&quot;quay.io/hypershift/hypershift:</span><span class="si">${</span><span class="nv">TAG</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--dns-zone-rg-name<span class="w"> </span><span class="si">${</span><span class="nv">PERSISTENT_RG_NAME</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--assign-service-principal-roles<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--workload-identities-file<span class="w"> </span>./workload-identities.json<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--diagnostics-storage-account-type<span class="w"> </span>Managed
</code></pre></div>
<h3 id="configuring-azure-marketplace-images">Configuring Azure Marketplace Images</h3>
<p>HyperShift supports multiple approaches for configuring Azure Marketplace images for your cluster nodes. The recommended approach varies based on your OpenShift version and requirements.</p>
<h4 id="for-openshift-420-and-later-recommended">For OpenShift 4.20 and Later (Recommended)</h4>
<p><strong>Pattern 1: Use Release Payload Defaults (Simplest)</strong></p>
<p>For OpenShift 4.20+, HyperShift automatically selects the appropriate Azure Marketplace image from the release payload. Simply omit all marketplace-related flags:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># No marketplace flags needed - HyperShift will auto-select the image</span>
<span class="c1"># Gen2 VM generation is used by default</span>
<span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>
</code></pre></div>
<p>This is the <strong>recommended approach</strong> as it ensures your nodes use the officially tested and supported image for your OpenShift version.</p>
<p><strong>Pattern 2: Specify VM Generation Only</strong></p>
<p>If you need to use a specific VM generation (Gen1 or Gen2), you can specify only the <code>--image-generation</code> flag:</p>
<div class="highlight"><pre><span></span><code><span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--image-generation<span class="w"> </span>Gen2<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># Or Gen1 (case-sensitive)</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">VM Generation</p>
<ul>
<li>Valid values: <code>Gen1</code> or <code>Gen2</code> (case-sensitive)</li>
<li>Default: <code>Gen2</code> (recommended for new clusters)</li>
<li>Gen2 VMs offer better performance and support for newer Azure features</li>
</ul>
</div>
<p><strong>Pattern 3: Use Custom Marketplace Image</strong></p>
<p>If you need to use a specific custom marketplace image, provide all marketplace details:</p>
<div class="highlight"><pre><span></span><code><span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-publisher<span class="w"> </span>azureopenshift<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-offer<span class="w"> </span>aro4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-sku<span class="w"> </span>aro_419<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-version<span class="w"> </span><span class="m">419</span>.6.20250523<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--image-generation<span class="w"> </span>Gen2<span class="w"> </span><span class="se">\ </span><span class="w"> </span><span class="c1"># Optional, defaults to Gen2</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Marketplace Flag Requirements</p>
<p>When specifying marketplace details, you must provide <strong>all four</strong> flags (<code>--marketplace-publisher</code>, <code>--marketplace-offer</code>, <code>--marketplace-sku</code>, <code>--marketplace-version</code>) together. Partial specification is not allowed.</p>
</div>
<h4 id="for-openshift-versions-before-420">For OpenShift Versions Before 4.20</h4>
<p>For OpenShift versions prior to 4.20, you must explicitly specify marketplace image details (Pattern 3 above) or provide a custom image ID. The automatic image selection from release payload is not available.</p>
<h4 id="adding-nodepools-with-custom-images">Adding NodePools with Custom Images</h4>
<p>When creating additional NodePools, you can specify image configuration in the same way:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Use default from release payload (OCP 4.20+)</span>
<span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>nodepool<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>

<span class="c1"># Or specify generation</span>
<span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>nodepool<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--image-generation<span class="w"> </span>Gen1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>

<span class="c1"># Or use custom marketplace image</span>
<span class="si">${</span><span class="nv">HYPERSHIFT_BINARY_PATH</span><span class="si">}</span>/hypershift<span class="w"> </span>create<span class="w"> </span>nodepool<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-name<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$CLUSTER_NAME</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-publisher<span class="w"> </span>azureopenshift<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-offer<span class="w"> </span>aro4<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-sku<span class="w"> </span>aro_419<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--marketplace-version<span class="w"> </span><span class="m">419</span>.6.20250523<span class="w"> </span><span class="se">\</span>
<span class="w">    </span><span class="c1"># ... other flags ...</span>
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Key Configuration Options</p>
<ul>
<li><code>--workload-identities-file</code>: References the workload identities configuration created in the setup guide</li>
<li><code>--assign-service-principal-roles</code>: Automatically assigns required Azure roles to workload identities</li>
<li><code>--sa-token-issuer-private-key-path</code>: Path to the private key for service account token signing</li>
<li><code>--oidc-issuer-url</code>: URL of the OIDC issuer created in the workload identity setup</li>
<li><code>--vnet-id</code>, <code>--subnet-id</code>, <code>--network-security-group-id</code>: Custom networking infrastructure</li>
<li><code>--image-generation</code>: (Optional) VM generation (<code>Gen1</code> or <code>Gen2</code>, defaults to <code>Gen2</code>). For OCP 4.20+, omit to use release payload defaults. See <a href="#configuring-azure-marketplace-images">Configuring Azure Marketplace Images</a></li>
<li><code>--marketplace-publisher/offer/sku/version</code>: (Optional) Explicit Azure Marketplace image. Must specify all four flags together, or omit all to use defaults (OCP 4.20+)</li>
<li><code>--dns-zone-rg-name</code>: Resource group containing the DNS zone (os4-common)</li>
<li><code>--diagnostics-storage-account-type Managed</code>: Use Azure managed storage for diagnostics</li>
<li><code>--control-plane-operator-image</code>: Custom HyperShift operator image (optional)</li>
</ul>
</div>
<h2 id="verification">Verification</h2>
<p>Check the cluster status and access:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Check HostedCluster status</span>
oc<span class="w"> </span>get<span class="w"> </span>hostedcluster<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span>-n<span class="w"> </span>clusters

<span class="c1"># Wait for cluster to be available</span>
oc<span class="w"> </span><span class="nb">wait</span><span class="w"> </span>--for<span class="o">=</span><span class="nv">condition</span><span class="o">=</span>Available<span class="w"> </span>hostedcluster/<span class="nv">$CLUSTER_NAME</span><span class="w"> </span>-n<span class="w"> </span>clusters<span class="w"> </span>--timeout<span class="o">=</span>30m

<span class="c1"># Get kubeconfig and access the cluster</span>
hypershift<span class="w"> </span>create<span class="w"> </span>kubeconfig<span class="w"> </span>--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-kubeconfig
<span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="nv">$CLUSTER_NAME</span>-kubeconfig
oc<span class="w"> </span>get<span class="w"> </span>nodes
oc<span class="w"> </span>get<span class="w"> </span>clusterversion
</code></pre></div>
<h2 id="cleanup">Cleanup</h2>
<p>To delete the HostedCluster:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete the HostedCluster</span>
hypershift<span class="w"> </span>destroy<span class="w"> </span>cluster<span class="w"> </span>azure<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--azure-creds<span class="w"> </span><span class="nv">$AZURE_CREDS</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--resource-group-name<span class="w"> </span><span class="nv">$MANAGED_RG_NAME</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Resource Cleanup</p>
<p>The HyperShift destroy command will clean up the cluster resources. Workload identities and OIDC issuer created during setup can be reused for other clusters or cleaned up separately if no longer needed.</p>
</div>
<h2 id="related-documentation">Related Documentation</h2>
<ol>
<li><a href="../azure-workload-identity-setup/">Azure Workload Identity Setup</a> - Workload identities and OIDC issuer setup</li>
<li><a href="../setup-management-cluster/">Setup Azure Management Cluster for HyperShift</a> - DNS and HyperShift operator setup</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>