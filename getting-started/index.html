
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Developer preview documentation for HyperShift on Azure" name="description"/>
<meta content="HyperShift Community" name="author"/>
<link href="https://hypershift-community.github.io/azure-dev-preview/getting-started/" rel="canonical"/>
<link href="../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.8" name="generator"/>
<title>Getting started - HyperShift Azure Developer Preview</title>
<link href="../assets/stylesheets/main.8608ea7d.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../custom.css" rel="stylesheet"/>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
 <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#prerequisites">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="HyperShift Azure Developer Preview" class="md-header__button md-logo" data-md-component="logo" href=".." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            HyperShift Azure Developer Preview
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Getting started
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../how-to/azure/self-managed/01-understanding/">
        
  
    
  
  Understanding

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../how-to/azure/self-managed/02-planning/">
        
  
    
  
  Planning

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../how-to/azure/self-managed/03-azure-foundation/">
        
  
    
  
  Azure Setup

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../how-to/azure/self-managed/04-management-cluster/">
          
  
    
  
  Management &amp; Hosted Clusters

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../how-to/azure/self-managed/07-troubleshooting/">
          
  
    
  
  Reference

        </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="HyperShift Azure Developer Preview" class="md-nav__button md-logo" data-md-component="logo" href=".." title="HyperShift Azure Developer Preview">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    HyperShift Azure Developer Preview
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/hypershift-community/azure-dev-preview" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"></path></svg>
</div>
<div class="md-source__repository">
    hypershift-community/azure-dev-preview
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/01-understanding/">
<span class="md-ellipsis">
    Understanding
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/02-planning/">
<span class="md-ellipsis">
    Planning
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/03-azure-foundation/">
<span class="md-ellipsis">
    Azure Setup
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Management &amp; Hosted Clusters
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Management &amp; Hosted Clusters
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/04-management-cluster/">
<span class="md-ellipsis">
    Management Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/05-hosted-cluster/">
<span class="md-ellipsis">
    Create Hosted Cluster
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/06-day2-operations/">
<span class="md-ellipsis">
    Day 2 Operations
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Reference
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Reference
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/07-troubleshooting/">
<span class="md-ellipsis">
    Troubleshooting
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../how-to/azure/self-managed/08-reference/">
<span class="md-ellipsis">
    Reference
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      Prerequisites
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#install-hypershift-operator">
<span class="md-ellipsis">
      Install HyperShift Operator
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-a-hosted-cluster">
<span class="md-ellipsis">
      Create a Hosted Cluster
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-additional-nodepools">
<span class="md-ellipsis">
      Create Additional NodePools
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scale-a-nodepool">
<span class="md-ellipsis">
      Scale a NodePool
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#delete-a-hosted-cluster">
<span class="md-ellipsis">
      Delete a Hosted Cluster
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="getting-started">Getting started</h1>
<p>HyperShift is middleware for hosting OpenShift control planes at scale that
solves for cost and time to provision, as well as portability across cloud service providers with
strong separation of concerns between management and workloads. Clusters are
fully compliant OpenShift Container Platform (OCP) clusters and are compatible
with standard OCP and Kubernetes toolchains.</p>
<p>This guide will lead you through the process of creating a new hosted cluster.
Throughout the instructions, shell variables are used to indicate values that
you should adjust to your own environment.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ol>
<li>Install the HyperShift CLI (<code>hypershift</code>) using Go 1.19:
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/openshift/hypershift.git
<span class="nb">cd</span><span class="w"> </span>hypershift
make<span class="w"> </span>build
sudo<span class="w"> </span>install<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>bin/hypershift<span class="w"> </span>/usr/local/bin/hypershift
</code></pre></div></td></tr></table></div></li>
<li>Admin access to an OpenShift cluster (version 4.12+) specified by the <code>KUBECONFIG</code> environment variable.</li>
<li>The OpenShift CLI (<code>oc</code>) or Kubernetes CLI (<code>kubectl</code>). </li>
<li>A valid <a href="https://cloud.redhat.com/openshift/install/aws/installer-provisioned">pull secret</a> file for the <code>quay.io/openshift-release-dev</code> repository. </li>
<li>An <a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-files.html">AWS credentials file</a> with <a href="/reference/infrastructure/aws.md">permissions</a> to create infrastructure for the cluster. </li>
<li>
<p>A Route53 public zone for cluster DNS records. To create a public zone:
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">BASE_DOMAIN</span><span class="o">=</span>www.example.com
aws<span class="w"> </span>route53<span class="w"> </span>create-hosted-zone<span class="w"> </span>--name<span class="w"> </span><span class="nv">$BASE_DOMAIN</span><span class="w"> </span>--caller-reference<span class="w"> </span><span class="k">$(</span>whoami<span class="k">)</span>-<span class="k">$(</span>date<span class="w"> </span>--rfc-3339<span class="o">=</span>date<span class="k">)</span>
</code></pre></div></td></tr></table></div></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To access applications in your guest clusters, the public zone must be routable. If the public zone exists, skip 
this step. Otherwise, the public zone will affect the existing functions.</p>
</div>
</li>
<li>
<p>An S3 bucket with public access to host OIDC discovery documents for your clusters. To create the bucket in <em>us-east-1</em>:
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">BUCKET_NAME</span><span class="o">=</span>your-bucket-name
aws<span class="w"> </span>s3api<span class="w"> </span>create-bucket<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span>
aws<span class="w"> </span>s3api<span class="w"> </span>delete-public-access-block<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">'{</span>
<span class="s1">  "Version": "2012-10-17",</span>
<span class="s1">  "Statement": [</span>
<span class="s1">    {</span>
<span class="s1">      "Effect": "Allow",</span>
<span class="s1">      "Principal": "*",</span>
<span class="s1">      "Action": "s3:GetObject",</span>
<span class="s1">      "Resource": "arn:aws:s3:::${BUCKET_NAME}/*"</span>
<span class="s1">    }</span>
<span class="s1">  ]</span>
<span class="s1">}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>envsubst<span class="w"> </span>&gt;<span class="w"> </span>policy.json
aws<span class="w"> </span>s3api<span class="w"> </span>put-bucket-policy<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span><span class="w"> </span>--policy<span class="w"> </span>file://policy.json
</code></pre></div></td></tr></table></div></p>
<p>To create the bucket in a region other than us-east-1:
    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">BUCKET_NAME</span><span class="o">=</span>your-bucket-name
<span class="nv">REGION</span><span class="o">=</span>us-east-2
aws<span class="w"> </span>s3api<span class="w"> </span>create-bucket<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--create-bucket-configuration<span class="w"> </span><span class="nv">LocationConstraint</span><span class="o">=</span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--region<span class="w"> </span><span class="nv">$REGION</span>
aws<span class="w"> </span>s3api<span class="w"> </span>delete-public-access-block<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span>
<span class="nb">echo</span><span class="w"> </span><span class="s1">'{</span>
<span class="s1">  "Version": "2012-10-17",</span>
<span class="s1">  "Statement": [</span>
<span class="s1">    {</span>
<span class="s1">      "Effect": "Allow",</span>
<span class="s1">      "Principal": "*",</span>
<span class="s1">      "Action": "s3:GetObject",</span>
<span class="s1">      "Resource": "arn:aws:s3:::${BUCKET_NAME}/*"</span>
<span class="s1">    }</span>
<span class="s1">  ]</span>
<span class="s1">}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>envsubst<span class="w"> </span>&gt;<span class="w"> </span>policy.json
aws<span class="w"> </span>s3api<span class="w"> </span>put-bucket-policy<span class="w"> </span>--bucket<span class="w"> </span><span class="nv">$BUCKET_NAME</span><span class="w"> </span>--policy<span class="w"> </span>file://policy.json
</code></pre></div></td></tr></table></div></p>
</li>
</ol>
<h2 id="install-hypershift-operator">Install HyperShift Operator</h2>
<p>Install the HyperShift Operator into the management cluster, specifying the OIDC bucket, its region and credentials to access it (see <a href="#prerequisites">Prerequisites</a>):</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">REGION</span><span class="o">=</span>us-east-1
<span class="nv">BUCKET_NAME</span><span class="o">=</span>your-bucket-name
<span class="nv">AWS_CREDS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.aws/credentials"</span>

hypershift<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--oidc-storage-provider-s3-bucket-name<span class="w"> </span><span class="nv">$BUCKET_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--oidc-storage-provider-s3-credentials<span class="w"> </span><span class="nv">$AWS_CREDS</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--oidc-storage-provider-s3-region<span class="w"> </span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--enable-defaulting-webhook<span class="w"> </span><span class="nb">true</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>enable-defaulting-webhook</code> is only for OCP version 4.14 and higher.</p>
</div>
<h2 id="create-a-hosted-cluster">Create a Hosted Cluster</h2>
<p>Create a new hosted cluster, specifying the domain of the public zone provided in the
<a href="#prerequisites">Prerequisites</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">REGION</span><span class="o">=</span>us-east-1
<span class="nv">CLUSTER_NAME</span><span class="o">=</span>example
<span class="nv">BASE_DOMAIN</span><span class="o">=</span>example.com
<span class="nv">AWS_CREDS</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/.aws/credentials"</span>
<span class="nv">PULL_SECRET</span><span class="o">=</span><span class="s2">"</span><span class="nv">$HOME</span><span class="s2">/pull-secret"</span>

hypershift<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>aws<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--node-pool-replicas<span class="o">=</span><span class="m">3</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--base-domain<span class="w"> </span><span class="nv">$BASE_DOMAIN</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--pull-secret<span class="w"> </span><span class="nv">$PULL_SECRET</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--aws-creds<span class="w"> </span><span class="nv">$AWS_CREDS</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--region<span class="w"> </span><span class="nv">$REGION</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--generate-ssh
</code></pre></div></td></tr></table></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The cluster name (<code>--name</code>) <em>must be unique within the base domain</em> to
avoid unexpected and conflicting cluster management behavior.</p>
<p>The cluster name must also adhere to the <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#dns-label-names">RFC1123 standard</a>.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You must include either flag, <code>release-image</code> or <code>release-stream</code>, when the <code>enable-defaulting-webhook</code> is not enabled on the installation of the HyperShift operator.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A default NodePool will be created for the cluster with 3 replicas per the
<code>--node-pool-replicas</code> flag. </p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The default NodePool name will be a combination of your cluster name and zone name for 
AWS (example, <code>example-us-east-1a</code>). For other providers, the default NodePool 
name will be the same as the cluster name.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>--generate-ssh</code> flag is not strictly necessary but it will help in
debugging why a node has not joined your cluster.</p>
</div>
<p>After a few minutes, check the <code>hostedclusters</code> resources in the <code>clusters</code>
namespace and when ready it will look similar to the following:</p>
<div class="highlight"><pre><span></span><code>oc get --namespace clusters hostedclusters
NAME      VERSION   KUBECONFIG                 PROGRESS    AVAILABLE   PROGRESSING   MESSAGE
example   4.12.0    example-admin-kubeconfig   Completed   True        False         The hosted control plane is available

oc get nodepools --namespace clusters
NAME                 CLUSTER   DESIRED NODES   CURRENT NODES   AUTOSCALING   AUTOREPAIR   VERSION   UPDATINGVERSION   UPDATINGCONFIG   MESSAGE
example-us-east-1a   example   2               2               False         False        4.12.0
</code></pre></div>
<p>Eventually the cluster's kubeconfig will become available and can be printed to
standard out using the <code>hypershift</code> CLI:</p>
<div class="highlight"><pre><span></span><code>hypershift<span class="w"> </span>create<span class="w"> </span>kubeconfig
</code></pre></div>
<h2 id="create-additional-nodepools">Create Additional NodePools</h2>
<p>Create additional NodePools for a cluster by specifying a name, number of replicas
and additional information such as instance type.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">NODEPOOL_NAME</span><span class="o">=</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span>-work
<span class="nv">INSTANCE_TYPE</span><span class="o">=</span>m5.2xlarge
<span class="nv">NODEPOOL_REPLICAS</span><span class="o">=</span><span class="m">2</span>

hypershift<span class="w"> </span>create<span class="w"> </span>nodepool<span class="w"> </span>aws<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--cluster-name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>clusters<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$NODEPOOL_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--replicas<span class="w"> </span><span class="nv">$NODEPOOL_REPLICAS</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--instance-type<span class="w"> </span><span class="nv">$INSTANCE_TYPE</span>
</code></pre></div></td></tr></table></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The default infrastructure created for the cluster during <a href="#create-a-hostedcluster">Create a HostedCluster</a>
lives in a single availability zone. Any additional NodePool created for that
cluster must be in the same availability zone and subnet.</p>
</div>
<p>Check the status of the NodePool by listing <code>nodepool</code> resources in the <code>clusters</code>
namespace:</p>
<div class="highlight"><pre><span></span><code>oc<span class="w"> </span>get<span class="w"> </span>nodepools<span class="w"> </span>--namespace<span class="w"> </span>clusters
</code></pre></div>
<h2 id="scale-a-nodepool">Scale a NodePool</h2>
<p>Manually scale a NodePool using the <code>oc scale</code> command:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nv">NODEPOOL_NAME</span><span class="o">=</span><span class="si">${</span><span class="nv">CLUSTER_NAME</span><span class="si">}</span>-work
<span class="nv">NODEPOOL_REPLICAS</span><span class="o">=</span><span class="m">5</span>

oc<span class="w"> </span>scale<span class="w"> </span>nodepool/<span class="nv">$NODEPOOL_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--namespace<span class="w"> </span>clusters<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--replicas<span class="o">=</span><span class="nv">$NODEPOOL_REPLICAS</span>
</code></pre></div></td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <a href="../how-to/automated-machine-management/nodepool-lifecycle/#scale-down">Scale Down</a> section of the <a href="../how-to/automated-machine-management/nodepool-lifecycle/">NodePool lifecycle page</a> for more details when scaling down NodePools.</p>
</div>
<h2 id="delete-a-hosted-cluster">Delete a Hosted Cluster</h2>
<p>To delete a Hosted Cluster:</p>
<div class="highlight"><pre><span></span><code>hypershift<span class="w"> </span>destroy<span class="w"> </span>cluster<span class="w"> </span>aws<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--aws-creds<span class="w"> </span><span class="nv">$AWS_CREDS</span>
</code></pre></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
<script src="https://unpkg.com/mermaid@11.4.0/dist/mermaid.min.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>